AWSTemplateFormatVersion: '2010-09-09'
Description: OpenSearch domain for Explicable search

Parameters:
  DomainName:
    Type: String
    Default: explicable-search-domain
    Description: Name of the OpenSearch domain

Resources:
  ExplicableSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: !Ref DomainName
      EngineVersion: OpenSearch_1.0
      ClusterConfig:
        InstanceType: t3.small.search
        InstanceCount: 2
        ZoneAwarenessEnabled: false
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp2
        VolumeSize: 10
      AccessPolicies:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              AWS: !Sub arn:aws:iam::${AWS::AccountId}:root
            Action:
              - es:ESHttpGet
              - es:ESHttpPost
              - es:ESHttpPut
              - es:ESHttpDelete
            Resource: !Sub arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/${DomainName}/*

Outputs:
  DomainEndpoint:
    Description: URL endpoint of the OpenSearch domain
    Value: !GetAtt ExplicableSearchDomain.DomainEndpoint
